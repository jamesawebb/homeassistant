- id: hk_casting
  alias: Harman Kardon AVR casting
  # Cf.  https://www.home-assistant.io/docs/automation/trigger/#multiple-triggers
  trigger:
  - entity_id: media_player.harman_kardon_avr
    platform: state
    to: "playing"
  - entity_id: media_player.harman_kardon_avr
    platform: state
    to: "paused"
  condition: []
  action:
  # Switch Harman Kardon to "Tape"
  - data:
      host: 192.168.86.75
      packet: "JgBQAAABKJURFBITERMTExETEhQRExQ2EhMSExITERQSNxM3EjgSExITFBESOBE5ERMTExE5ETgSOBI4ERQSExE5ETkRExITEgAF0QABKEoTAA0FAAAAAAAAAAA=="
    service: broadlink.send

- id: hd_tv_on
  alias: Samsung TV switched on
  trigger:
  - entity_id: media_player.samsung_ua65hu9000
    platform: state
    to: "on"
  condition: []
  action:
  # Switch Harman Kardon to "VID1"
  - service: broadlink.send
    data:
      host: 192.168.86.75
      packet: "JgBYAAABJ5UTExETEhQRExITEhMSExE5ERQSExETExMROBI4EjgRFBITETkRExM3EhQRExI4EjgSNxMTETkRExI4EjgSExEUEgAF0QABJ0sSAAxsAAEoSxIADQU="

- id: hk_tv_off_casting_off
  alias: Samsung TV switched off, no casting
  trigger:
  - entity_id: media_player.samsung_ua65hu9000
    platform: state
    to: "off"
  condition:
  # Only switch HK off if we're not casting
  - condition: state
    entity_id: 'media_player.harman_kardon_avr'
    state: 'off'
    for:
      seconds: 10
  action:
  - service: switch.turn_off
    entity_id: switch.harman_kardon_pwr

- id: hk_casting_off_tv_off
  alias: Harman Kardon AVR casting off, TV off
  trigger:
  - entity_id: media_player.harman_kardon_avr
    platform: state
    to: 'off'
  condition:
  # Only switch HK off if the TV is off too
  - condition: state
    entity_id: 'media_player.samsung_ua65hu9000'
    state: 'off'
    for:
      seconds: 10
  action:
  - service: switch.turn_off
    entity_id: switch.harman_kardon_pwr
